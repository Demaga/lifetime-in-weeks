{% extends 'lifetime/base.html' %}
{% load lifetime_tags %}

{% block main %}
<header>
    <a href="/" style="text-decoration: none; color: black;">
        <h1>Life in Weeks</h1>
    </a>
    {% if lifetime.name %}
    <p><b>{{ lifetime.name }}</b> ({{ lifetime.birth_date }} - {{ lifetime.death_date }})</p>
    {% else %}
    <p>Birth date: {{ lifetime.birth_date }}</p>
    {% endif %}
</header>

<div class="weeks-container">
    <div class="year-labels">
        {% for year in "x"|rjust:years %}
        <div class="year-label">Year {{ forloop.counter }}</div>
        {% endfor %}
    </div>

    <div class="weeks-grid">
        {% with weeks_with_events=lifetime.events.all|map_weeks_to_events %}
        {% for year in "x"|rjust:years %}
        {% with year_start=forloop.counter0|multiply:52 %}
        <div class="year-container">
            <!-- First half of the year (weeks 1-26) -->
            <div class="year-row">
                {% for week in "x"|rjust:"26" %}
                {% with week_number=year_start|add:forloop.counter %}
                <div class="week 
                    {% if week_number in weeks_with_events %}has-events{% endif %} 
                    {% if week_number <= current_week %}past{% endif %} 
                    {% if death_week and week_number == death_week %}death{% endif %} 
                    {% if death_week and week_number > death_week %}after-death{% endif %} 
                    {% if expected_death_week and week_number == expected_death_week %}expected-death{% endif %}"
                    title="Week {{ week_number }}">
                </div>
                {% endwith %}
                {% endfor %}
            </div>

            <!-- Second half of the year (weeks 27-52) -->
            <div class="year-row">
                {% for week in "x"|rjust:"26" %}
                {% with week_number=year_start|add:26|add:forloop.counter %}
                <div class="week 
                    {% if week_number in weeks_with_events %}has-events{% endif %} 
                    {% if week_number <= current_week %}past{% endif %} 
                    {% if death_week and week_number == death_week %}death{% endif %} 
                    {% if death_week and week_number > death_week %}after-death{% endif %} 
                    {% if expected_death_week and week_number == expected_death_week %}expected-death{% endif %}"
                    title="Week {{ week_number }}">
                </div>
                {% endwith %}
                {% endfor %}
            </div>
        </div>
        {% endwith %}
        {% endfor %}
        {% endwith %}
    </div>
</div>

{% endblock %}